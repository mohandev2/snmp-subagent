
This is an implementation of the Service Availability Forum's 
Hardware Platform Interface SNMP sub-agent.

Through this subagent one can includes support for multiple different 
types of hardware including: IPMI, IBM Blade Center (via SNMP), 
Linux Watchdog devices, and Sysfs based systems.

---------------------------------------------------------
PREREQUISITES
---------------------------------------------------------
The following software is required to build openhpi

any HPI 1.0 implementation that is based on SAF specification 
	SAI-HPI-A.01.01. Recommended: openhpi >= 0.4
autoconf >= 2.50
automake >= 1.5
net-snmp >= 5.1.0
	(Don't use earlier versions - the AgentX protocol had some
	 serious issues).
	(Don't use 5.0.7 - it has a bug in the CONTAINER operations that 
	 seg faults the sub-agent).
GLIB-2.1

---------------------------------------------------------
BUILD / INSTALLATION
---------------------------------------------------------
First time to extract the code:
run ./boostrap

This will generate all files needed to compile.

after running the bootstrap script, run:
	./configure

then make (or make rpm)
and then (as root or with proper system install permissions)
	make install (or install from the rpm).

It will generate the subagent code and put the configuration file 
- hpiSubagent.conf in the NetSNMP configuration directory.

If you want to generate the guide, run:
        make pdf-m

in the docs directory.
---------------------------------------------------------
RUNNING
---------------------------------------------------------

1. Configure your OpenHPI installation to work. Make sure that 
   /etc/openhpi/openhpi.conf lists the desired plugin.

2. Configure your NetSNMP configuration file (snmpd.conf) to include
   "master  agentx"

3. Start the NetSNMP daemon. (usually /etc/init.d/snmpd on various Linux distros).

4. Start the hpiSubagent. (either use the runtime script: /etc/init.d/openhpi-subagent,
   or just run it from the terminal).  You should see something similar in the
   syslog log file - /var/log/messages:

   ...
   Feb  6 10:53:37 konrad hpiSubagent[9890]: Not sending events during startup.
   Feb  6 10:53:37 konrad hpiSubagent[9890]: Checking HPI infrastructure every 4 seconds.
   Feb  6 10:53:37 konrad hpiSubagent[9890]: Max Event rows 1024.
   ...

5. Browse the MIB tree. When browsing the MIB tree, make sure you 
   load the MIB in your favorite SNMP browser. If you are using 
   NetSNMP commands, set the MIBS environment variable to ALL:

   $export MIBS=ALL
  
   And set the MIBDIRS enviroment variable to point to the the directory where the 
   OpenHPI MIB file is located (usr/share/doc/openhpi-subagent-0.2/mib) or
   copy the MIB file in to the NetSNMP MIB default directory (usually 
   /usr/share/snmp/mibs). To set the MIBDIRS, refer to 'man snmpcmd' or:

   $export MIBDIRS=+/usr/share/doc/openhpi-subagent-0.2/mibs

   After these step you should have no trouble browsing the HPI MIB:

   $snmpwalk -v2c -c public localhost hpi
   HPI-MIB::saHpiEntryCount.0 = Counter32: 3
   HPI-MIB::saHpiEntryUpdateCount.0 = Gauge32: 3
   HPI-MIB::saHpiEntryUpdateTimestamp.0 = Counter64: 1076082821603968000
   HPI-MIB::saHpiDomainID.0.1.1 = Gauge32: 0
   HPI-MIB::saHpiDomainID.0.2.2 = Gauge32: 0
   HPI-MIB::saHpiDomainID.0.3.3 = Gauge32: 0
   HPI-MIB::saHpiEntryID.0.1.1 = Gauge32: 1
   HPI-MIB::saHpiEntryID.0.2.2 = Gauge32: 2
   HPI-MIB::saHpiEntryID.0.3.3 = Gauge32: 3
   HPI-MIB::saHpiResourceID.0.1.1 = Gauge32: 1
   HPI-MIB::saHpiResourceID.0.2.2 = Gauge32: 2
   HPI-MIB::saHpiResourceID.0.3.3 = Gauge32: 3
   HPI-MIB::saHpiResourceEntityPath.0.1.1 = STRING: "{ROOT,0}{SYSTEM_CHASSIS,1}{SYSTEM_BOARD,1}"
   HPI-MIB::saHpiResourceEntityPath.0.2.2 = STRING: "{ROOT,0}{SYSTEM_CHASSIS,1}{POWER_SUPPLY,1}"
   ....

6). If you want to receive traps make sure you are running a SNMP trap daemon
    (NetSNMP provides one - snmptrapd). 
    Furthermore make sure that the SNMP daemon is configured to send traps 
    and specify its destination, such as:
    "inform2sink <hostname>" in snmpd.conf.
    Refer to 'man snmpd.conf' for more details.

---------------------------------------------------------
CLEANUP
---------------------------------------------------------
To remove the temporary build files, type:

make clean

If you are a maintainer, and need to remove all autogenerated files, type:

make clean
make maintainer-clean


---------------------------------------------------------
GENERAL RELEASE NOTES and WHAT'S NEW
---------------------------------------------------------

* Second release of the HPI SNMP sub-agent. 

* Support for full implementation of the HPI-MIB v1.4
  (included). This means HPI 1.0 instrumentation using 
  HPI-MIB objects in twenty-three tables:
	- Resource Presence Table entities,
		- HotSwap capabilities,
	- Resource Data Records,
		- Sensors
		    - Current sensor reading,
		    - Reading values for 
			 - Max,
			 - Min, 
			 - Nominal, 
			 - Normal maximum, 
			 - Normal minimum
		    - Threshold values for:
			- Upper Critical,
			- Upper Major,
			- Upper Minor,
			- Lower Critical,
			- Lower Major,
			- Lower Minor,
			- Positive Hysteresis,
			- Negativie Hysteresis	
		- Inventory,
		- Control,
		- Watchdog
	- Events and System Event Log

* SGML Guide for writing a sub-agent using NetSNMP API, titled:
  "NetSNMP subagent development manual."

* Support for notifications/TRAPS as defined in the MIB:
	- For Events:
		- Sensor,
		- Hot Swap,
		- Watchdog,
		- OEM,
		- User
	- For Resource Data Records,
	- For Resource Presence Table

* Support for user configurable options:
	 - update timer for new RPT/RDR/Events ,
	 - maximum events held in eventw row before they are
	   automatically removed,
	 - sending of new found RPT/RDR/Events during startup.

* Example code for retrieving instrumentation information
  using SNMP.

* Fix many bugs:

Consult the ChangeLog for more details.

---------------------------------------------------------
FOR MORE INFO
---------------------------------------------------------

For more information please see the project website at 
http://openhpi.sourceforge.net

Also visit SAForum's website at http://www.saforum.org


---------------------------------------------------------
BUGS
---------------------------------------------------------

If you have any bugs, issues, please visit the project
website http://openhpi.sourceforge.net, or visit us
in the #openhpi channel on FreeNode and OFTN network.


---------------------------------------------------------
DEFINES
---------------------------------------------------------

